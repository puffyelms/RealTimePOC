//var initial =  [
//    { "coupon": 1.0, "month1": 100, "month2" : 100, "month3": 100, "month4" : 100  },
//    { "coupon": 1.5, "month1": 100, "month2" : 100, "month3": 100, "month4" : 100  },
//    { "coupon": 2.0, "month1": 100, "month2" : 100, "month3": 100, "month4" : 100  },
//    { "coupon": 2.5, "month1": 100, "month2" : 100, "month3": 100, "month4" : 100  }
//];

var initial = {};
initial['1.0'] =   { "coupon": 1.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['1.5'] =   { "coupon": 1.5, cellMonth1 :  {"currentPrice" : 101, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['2.0'] =   { "coupon": 2.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['2.5'] =   { "coupon": 2.5, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['3.0'] =   { "coupon": 3.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['3.5'] =   { "coupon": 3.5, cellMonth1 :  {"currentPrice" : 101, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['4.0'] =   { "coupon": 4.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['4.5'] =   { "coupon": 4.5, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['5.0'] =   { "coupon": 5.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['5.5'] =   { "coupon": 4.5, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['6.0'] =   { "coupon": 5.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['6.5'] =   { "coupon": 5.5, cellMonth1 :  {"currentPrice" : 101, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};
initial['7.0'] =   { "coupon": 6.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
    cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
};

//var initial3 =  [
//    { "coupon": 1.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
//    },
//    { "coupon": 1.5, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
//    },
//    { "coupon": 2.0, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
//    },
//    { "coupon": 2.5, cellMonth1 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth2 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth3 :  {"currentPrice" : 100, "cobPrice" : 115 } ,
//        cellMonth4 :  {"currentPrice" : 100, "cobPrice" : 115 }
//    }
//];

    //{ "coupon": 1.5, "month1": 100, "month2" : 100, "month3": 100, "month4" : 100  },
    //{ "coupon": 2.0, "month1": 100, "month2" : 100, "month3": 100, "month4" : 100  },
    //{ "coupon": 2.5, "month1": 100, "month2" : 100, "month3": 100, "month4" : 100  }
//];

var changed =  [
    { "coupon": 1.0, "month1": 1,  "month2" : 2200, "month3": 1, "month4" : 200  },
    { "coupon": 1.5, "month1": 1,  "month2" : 1000, "month3": 8200, "month4" : 200  },
    { "coupon": 2.0, "month1": 1,  "month2" : 2200, "month3": 10, "month4" : 200  },
    { "coupon": 2.5,"month1": 1, "month2" : 1990, "month3": 11, "month4" : 1111  }
];

(function (app, ng) {
    'use strict';

    app.controller('AppCtrl', ['$scope', function ($scope) {
        var vm = this;

        $scope.stagedProductGrid = {};
        $scope.customParams = {};

        $scope.setStagedProductData = function(data2) {
            $scope.stagedProductGrid = data2;
        }

        //Called from websockets.
        $scope.updateStagedData = function () {
            var newData2 = $scope.stagedProductGrid;
            for (var key in newData2) {
                var obj = newData2[key];

                var couponToModify = vm.productGrid[obj.coupon];
                couponToModify.cellMonth1.currentPrice = obj.month1;
                couponToModify.cellMonth2.currentPrice = obj.month2;
                couponToModify.cellMonth3.currentPrice = obj.month3;
                couponToModify.cellMonth4.currentPrice = obj.month4;
                var i = 1;
            }
            //var newString = vm.productGrid['1.0'];
            //vm.productGrid = $scope.stagedProductGrid;
        };

        vm.productGrid = ng.copy(initial);

        vm.loadData = function loadData() {
            vm.productGrid = ng.copy(changed);
        };

        vm.changeValue = function changeValue() {
            vm.productGrid[0].month1 = 99;
        };

        vm.revert = function revert() {
            vm.productGrid = ng.copy(initial);
        };
    }]);

    app.directive('highlighter', ['$timeout', function($timeout) {
        return {
            restrict: 'A',
            scope: {
                model: '=highlighter'
            },
            link: function(scope, element) {
                scope.$watch(
                    'model',
                    function (newVal, oldVal) {


                        if (newVal.currentPrice > newVal.cobPrice) {
                            element.addClass('highlight-cob-up');
                            element.removeClass('highlight-cob-down');
                        } else if (newVal.currentPrice < newVal.cobPrice) {
                            element.addClass('highlight-cob-down');
                            element.removeClass('highlight-cob-up');
                        } else {
                            element.removeClass('highlight-cob-up');
                            element.removeClass('highlight-cob-down');
                        }

                        if (newVal.currentPrice > oldVal.currentPrice) {
                            // apply class
                            //$('#lblName').closest('tr').index();
                            element.addClass('highlight-up white-text');

                            // auto remove after some delay
                            $timeout(function () {
                                element.removeClass('highlight-up white-text');
                            }, 2000);
                        } else if (newVal.currentPrice < oldVal.currentPrice) {
                            // apply class
                            element.addClass('highlight-down white-text');

                            // auto remove after some delay
                            $timeout(function () {
                                element.removeClass('highlight-down white-text');
                            }, 2000);
                        }

                    },true
                );
            }
        };
    }]);
})(angular.module('app', []), angular);


